<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”»åƒã®è‰²å–å¾—ãƒ„ãƒ¼ãƒ« | PocketPortal Tools</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap');
        body { font-family: 'Inter', 'Noto Sans JP', sans-serif; }
        .drop-area {
            border: 2px dashed #cbd5e1;
            background-color: #f8fafc;
            transition: all 0.2s ease-in-out;
        }
        .drop-area.highlight {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        #color-display {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 0 0 1px #cbd5e1;
        }
        #image-canvas {
            cursor: crosshair;
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen flex flex-col">

    <nav class="bg-white border-b border-slate-200 py-4 px-6 sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <a href="../../index.html" class="flex items-center gap-2 font-bold text-lg text-blue-700">
                <span>ğŸ </span> PocketPortal
            </a>
            <span class="text-xs font-bold text-slate-400 uppercase tracking-widest">Web Tools</span>
        </div>
    </nav>

    <header class="bg-white border-b border-slate-100 py-8 px-6">
        <div class="container mx-auto text-center">
            <h1 class="text-2xl font-bold text-slate-800 mb-2">ç”»åƒã®è‰²å–å¾—ãƒ„ãƒ¼ãƒ«</h1>
            <p class="text-xs text-slate-500">ç”»åƒã‹ã‚‰HEX/RGBã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’ç°¡å˜ã«æŠ½å‡º</p>
        </div>
    </header>

    <main class="flex-grow container mx-auto py-10 px-6 max-w-3xl">
        <div class="bg-white rounded-3xl shadow-xl border border-slate-100 p-8 md:p-10 mb-8">
            <div id="drop-area" class="drop-area p-8 rounded-xl text-center cursor-pointer flex flex-col items-center justify-center mb-6">
                <span class="text-4xl text-slate-400 mb-3">ğŸ–¼ï¸</span>
                <p class="font-bold text-slate-600">ç”»åƒã‚’ã“ã“ã«ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—</p>
                <p class="text-sm text-slate-500 mt-1">ã¾ãŸã¯ <label for="file-input" class="text-blue-600 cursor-pointer hover:underline">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</label></p>
                <input type="file" id="file-input" accept="image/*" class="hidden">
            </div>

            <div id="image-preview" class="hidden mb-6 relative">
                <canvas id="image-canvas" class="block w-full h-auto rounded-lg shadow-md border border-slate-200"></canvas>
                <button onclick="resetTool()" class="absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white p-2 rounded-full text-xs opacity-80 hover:opacity-100 transition">
                    Ã— ãƒªã‚»ãƒƒãƒˆ
                </button>
            </div>

            <div id="color-info" class="hidden flex flex-col md:flex-row items-center justify-center gap-4 bg-slate-50 p-4 rounded-xl border border-slate-200">
                <div id="color-display" class="shrink-0"></div>
                <div>
                    <p class="text-xs text-slate-500 font-medium">å–å¾—ã—ãŸè‰²æƒ…å ±:</p>
                    <p class="text-xl font-bold text-slate-800" id="hex-code">#------</p>
                    <p class="text-sm text-slate-600" id="rgb-code">rgb(---, ---, ---)</p>
                </div>
                <button onclick="copyColorCode('hex')" class="bg-slate-900 hover:bg-slate-800 text-white px-4 py-2 rounded-lg text-xs font-bold transition-all ml-auto">
                    HEXã‚³ãƒ”ãƒ¼
                </button>
            </div>
        </div>

        <div class="mt-8 p-6 bg-blue-50 rounded-2xl border border-blue-100 text-center">
            <p class="text-[10px] font-bold text-blue-600 uppercase tracking-widest mb-3">ãƒ‡ã‚¶ã‚¤ãƒ³ä½œæ¥­åŠ¹ç‡UPï¼</p>
            <a href="https://af.moshimo.com/..." target="_blank" class="block group">
                <div class="bg-white p-4 rounded-xl shadow-sm border border-blue-200 group-hover:border-blue-400 transition-all text-left flex items-center gap-4">
                    <div class="text-3xl">ğŸ¨</div>
                    <div class="flex-1">
                        <p class="text-sm font-bold text-blue-800 mb-1">Adobe Creative Cloud</p>
                        <p class="text-[10px] text-blue-600 opacity-80 leading-tight">Photoshop, Illustratorã§ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’ã‚‚ã£ã¨è‡ªç”±ã«ã€‚</p>
                    </div>
                    <div class="text-blue-300 group-hover:text-blue-500">â†’</div>
                </div>
            </a>
        </div>
    </main>

    <footer class="py-8 text-center text-slate-400 text-[10px]">
        <p>Â© 2024 PocketPortal Tools - ç”»åƒãƒ‡ãƒ¼ã‚¿ã¯ä¿å­˜ã•ã‚Œã¾ã›ã‚“</p>
    </footer>

    <script>
        const dropArea = document.getElementById('drop-area');
        const fileInput = document.getElementById('file-input');
        const imagePreview = document.getElementById('image-preview');
        const imageCanvas = document.getElementById('image-canvas');
        const ctx = imageCanvas.getContext('2d', { willReadFrequently: true });
        const colorInfo = document.getElementById('color-info');
        const colorDisplay = document.getElementById('color-display');
        const hexCode = document.getElementById('hex-code');
        const rgbCode = document.getElementById('rgb-code');
        let currentImage = null; // ç¾åœ¨è¡¨ç¤ºä¸­ã®ç”»åƒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

        // --- Drag & Drop å‡¦ç† ---
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
            document.body.addEventListener(eventName, preventDefaults, false); // å…¨ä½“ã¸ã®ãƒ‰ãƒ­ãƒƒãƒ—é˜²æ­¢
        });

        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, unhighlight, false);
        });

        dropArea.addEventListener('drop', handleDrop, false);
        fileInput.addEventListener('change', handleFiles, false);

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        function highlight() { dropArea.classList.add('highlight'); }
        function unhighlight() { dropArea.classList.remove('highlight'); }

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles({ target: { files: files } });
        }

        function handleFiles(e) {
            const files = e.target.files;
            if (files.length === 0) return;

            const file = files[0];
            if (!file.type.startsWith('image/')) {
                alert('ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    currentImage = img;
                    drawImageOnCanvas(img);
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }

        function drawImageOnCanvas(img) {
            const maxWidth = imagePreview.offsetWidth; // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ã®å¹…ã«åˆã‚ã›ã‚‹
            const ratio = img.width / img.height;
            let newWidth = maxWidth;
            let newHeight = maxWidth / ratio;

            if (newHeight > window.innerHeight * 0.7) { // ç”»é¢ã®é«˜ã•ã«åã¾ã‚‹ã‚ˆã†ã«èª¿æ•´
                newHeight = window.innerHeight * 0.7;
                newWidth = newHeight * ratio;
            }

            imageCanvas.width = newWidth;
            imageCanvas.height = newHeight;
            ctx.drawImage(img, 0, 0, newWidth, newHeight);

            dropArea.classList.add('hidden');
            imagePreview.classList.remove('hidden');
            colorInfo.classList.add('hidden'); // è‰²æƒ…å ±ã¯ãƒªã‚»ãƒƒãƒˆæ™‚ã«éš ã™
            resetColorInfo(); // è¡¨ç¤ºã‚‚ãƒªã‚»ãƒƒãƒˆ
        }

        imageCanvas.addEventListener('mousemove', function(e) {
            if (!currentImage) return;

            const rect = imageCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            const pixel = ctx.getImageData(x, y, 1, 1).data;
            const r = pixel[0];
            const g = pixel[1];
            const b = pixel[2];

            const hex = rgbToHex(r, g, b);
            
            colorDisplay.style.backgroundColor = hex;
            hexCode.innerText = hex;
            rgbCode.innerText = `rgb(${r}, ${g}, ${b})`;
            colorInfo.classList.remove('hidden');
        });

        // ã‚¯ãƒªãƒƒã‚¯æ™‚ã«ã‚‚è‰²æƒ…å ±ã‚’å›ºå®šè¡¨ç¤º
        imageCanvas.addEventListener('click', function(e) {
             // mousemoveã§æ—¢ã«æ›´æ–°ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ç‰¹ã«å‡¦ç†ã¯ä¸è¦ã ãŒã€
             // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚‰æƒ…å ±ãŒå›ºå®šã•ã‚Œã‚‹ã‚ˆã†ãªUIã«ã—ã¦ã‚‚è‰¯ã„
        });


        function rgbToHex(r, g, b) {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase();
        }

        function copyColorCode(type) {
            const code = type === 'hex' ? hexCode.innerText : rgbCode.innerText;
            navigator.clipboard.writeText(code).then(() => {
                const btn = event.target;
                const originalText = btn.innerText;
                btn.innerText = "âœ… ã‚³ãƒ”ãƒ¼å®Œäº†ï¼";
                setTimeout(() => btn.innerText = originalText, 2000);
            });
        }

        function resetTool() {
            dropArea.classList.remove('hidden');
            imagePreview.classList.add('hidden');
            colorInfo.classList.add('hidden');
            fileInput.value = null; // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã‚‚ãƒªã‚»ãƒƒãƒˆ
            currentImage = null;
            resetColorInfo();
        }

        function resetColorInfo() {
            colorDisplay.style.backgroundColor = '#cccccc';
            hexCode.innerText = '#------';
            rgbCode.innerText = 'rgb(---, ---, ---)';
        }
    </script>
</body>
</html>