<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ | PocketPortal Tools</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Sans+JP:wght@700&display=swap');
        body { font-family: 'Inter', 'Noto Sans JP', sans-serif; }
        .spinning { transition: transform 4s cubic-bezier(0.15, 0, 0.15, 1); }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    </style>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9V96DZHTH1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-9V96DZHTH1');
    </script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6758339830570094" crossorigin="anonymous"></script>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen flex flex-col">

   <nav class="bg-white border-b border-slate-200 py-4 px-6 sticky top-0 z-50">
    <div class="container mx-auto flex justify-between items-center">
        <a href="../index.html" class="flex items-center gap-2 font-bold text-lg text-blue-700">
            <span>ğŸ </span> PocketPortal
        </a>
        <a href="./index.html" class="text-[10px] text-slate-400 hover:text-blue-500 transition-colors">Webä¾¿åˆ©ãƒ„ãƒ¼ãƒ«é›†ã¸</a>
    </div>
   </nav>

    <main class="flex-grow container mx-auto py-10 px-6 max-w-2xl text-center">
        <div class="bg-white rounded-[3rem] shadow-xl border border-slate-100 p-8 relative overflow-hidden mb-8">
            <h1 class="text-xl font-bold text-slate-800 mb-8">ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ</h1>
            
            <div class="relative inline-block mb-6">
                <div class="absolute top-0 left-1/2 -translate-x-1/2 w-0 h-0 border-l-[12px] border-l-transparent border-r-[12px] border-r-transparent border-t-[24px] border-t-red-500 z-10 -mt-2"></div>
                <canvas id="roulette-canvas" width="320" height="320" class="mx-auto spinning drop-shadow-lg"></canvas>
            </div>

            <div id="roulette-result" class="text-2xl font-black text-indigo-600 h-10 mb-8">é …ç›®ã‚’å…¥åŠ›ã—ã¦ã‚¹ã‚¿ãƒ¼ãƒˆï¼</div>

            <div class="max-w-sm mx-auto mb-6 flex gap-2">
                <select id="mode-select" onchange="toggleMode()" class="flex-1 p-2 bg-slate-100 rounded-lg text-xs font-bold border-none outline-none">
                    <option value="equal">å‡ç­‰å‰²ã‚Šï¼ˆè‡ªç”±å…¥åŠ›ï¼‰</option>
                    <option value="custom">å€‹åˆ¥å‰²åˆï¼ˆæœ€å¤§10ä»¶ï¼‰</option>
                </select>
                <select id="order-select" onchange="drawRoulette()" class="flex-1 p-2 bg-slate-100 rounded-lg text-xs font-bold border-none outline-none">
                    <option value="normal">è¨­å®šé †</option>
                    <option value="shuffle">ãƒ©ãƒ³ãƒ€ãƒ é †</option>
                </select>
            </div>

            <div class="space-y-4 max-w-sm mx-auto">
                <div id="equal-area">
                    <textarea id="roulette-items" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl text-sm font-bold focus:ring-2 focus:ring-indigo-500 outline-none h-32 resize-none" placeholder="é …ç›®ã‚’æ”¹è¡ŒåŒºåˆ‡ã‚Šã§å…¥åŠ›...">ãƒ©ãƒ³ãƒ&#13;ã‚«ãƒ•ã‚§&#13;ãƒ©ãƒ¼ãƒ¡ãƒ³&#13;ãƒ‘ã‚¹ã‚¿</textarea>
                </div>

                <div id="custom-area" class="hidden space-y-2">
                    <div class="flex justify-between items-center px-2 mb-2">
                        <span class="text-[10px] font-bold text-slate-400 uppercase">åˆè¨ˆ: <span id="total-percent">0</span>/100%</span>
                        <select id="template-select" onchange="applyTemplate()" class="p-1 bg-indigo-50 text-indigo-600 rounded text-[10px] font-bold border-none outline-none">
                            <option value="">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ</option>
                        </select>
                    </div>
                    <div id="weight-inputs" class="grid grid-cols-1 gap-2 max-h-60 overflow-y-auto pr-2">
                        </div>
                </div>

                <button onclick="spinRoulette()" id="spin-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-4 rounded-2xl font-bold transition-all active:scale-95 shadow-lg shadow-indigo-100">ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã‚’å›ã™</button>
            </div>
        </div>

        <div class="w-full flex flex-col items-center mt-8">
            <p class="text-[10px] text-slate-400 mb-2 font-bold uppercase tracking-widest">Sponsor Link</p>
            <div class="bg-white p-1 rounded shadow-sm">
                <script type="text/javascript">rakuten_design="slide";rakuten_affiliateId="022cbf82.9ae811c1.06d2eb59.bd2a4ff3";rakuten_items="ctsmatch";rakuten_genreId="0";rakuten_size="300x250";rakuten_target="_blank";rakuten_theme="gray";rakuten_border="off";rakuten_auto_mode="on";rakuten_genre_title="off";rakuten_recommend="on";rakuten_ts="1770128068587";</script><script type="text/javascript" src="https://xml.affiliate.rakuten.co.jp/widget/js/rakuten_widget.js?20230106"></script>
            </div>
        </div>
    </main>

    <footer class="py-8 text-center text-slate-400 text-[10px]">
        <p>Â© 2026 PocketPortal Tools</p>
    </footer>

    <script>
        const canvas = document.getElementById('roulette-canvas');
        const ctx = canvas.getContext('2d');
        let currentRotation = 0;
        let currentItems = []; // æç”»ç”¨ã®ç¢ºå®šæ¸ˆã¿ã‚¢ã‚¤ãƒ†ãƒ 

        const templates = [
            { name: "Yes or No", items: [{n:"Yes", w:50}, {n:"No", w:50}] },
            { name: "ä»Šæ—¥ã®ãƒ©ãƒ³ãƒ", items: [{n:"å’Œé£Ÿ", w:25}, {n:"ä¸­è¯", w:25}, {n:"ã‚¤ã‚¿ãƒªã‚¢ãƒ³", w:25}, {n:"è‚‰æ–™ç†", w:25}] },
            { name: "å®¶äº‹åˆ†æ‹…", items: [{n:"çš¿æ´—ã„", w:20}, {n:"æ´—æ¿¯", w:20}, {n:"æƒé™¤æ©Ÿ", w:20}, {n:"é¢¨å‘‚æƒé™¤", w:20}, {n:"ã‚´ãƒŸå‡ºã—", w:20}] },
            { name: "è‡ªåˆ†ã¸ã®ã”è¤’ç¾", items: [{n:"ã‚¹ã‚¤ãƒ¼ãƒ„", w:50}, {n:"æ–°ä½œã‚²ãƒ¼ãƒ ", w:10}, {n:"ãƒ“ãƒ¼ãƒ«", w:30}, {n:"é«˜ç´šç„¼è‚‰", w:10}] },
            { name: "æ¬¡ã«é£²ã‚€ã‚‚ã®", items: [{n:"ãƒ“ãƒ¼ãƒ«", w:25}, {n:"ãƒã‚¤ãƒœãƒ¼ãƒ«", w:25}, {n:"é…ãƒã‚¤", w:25}, {n:"æ—¥æœ¬é…’", w:25}] },
            { name: "ãŠå‡ºã‹ã‘", items: [{n:"æµ·æ–¹é¢", w:25}, {n:"å±±æ–¹é¢", w:25}, {n:"éš£ã®çœŒ", w:25}, {n:"åœ°å…ƒ", w:25}] },
            { name: "é€±æœ«ã®äºˆå®š", items: [{n:"æ˜ ç”»", w:30}, {n:"è²·ã„ç‰©", w:30}, {n:"å¯å€’ã™", w:30}, {n:"æ—…è¡Œ", w:10}] },
            { name: "é£²ã¿ä¼šã®å½¹å‰²", items: [{n:"å¹¹äº‹", w:10}, {n:"ä¼šè¨ˆ", w:20}, {n:"ç››ã‚Šä¸Šã’å½¹", w:40}, {n:"ä»‹æŠ±ä¿‚", w:30}] },
            { name: "ç­‹ãƒˆãƒ¬ãƒ¡ãƒ‹ãƒ¥ãƒ¼", items: [{n:"è…•ç«‹ã¦", w:25}, {n:"è…¹ç­‹", w:25}, {n:"èƒŒç­‹", w:25}, {n:"ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ", w:25}] },
            { name: "æ˜æ—¥ã®é‹å‹¢", items: [{n:"å¤§å‰", w:10}, {n:"ä¸­å‰", w:30}, {n:"å°å‰", w:40}, {n:"æœ«å‰", w:20}] },
            { name: "ã‚­ãƒ£ãƒã‚¯ãƒ©éŠã³", items: [{n:"LINEäº¤æ›", w:30}, {n:"ãƒ‰ãƒªãƒ³ã‚¯", w:40}, {n:"åŒä¼´", w:15}, {n:"ã‚·ãƒ£ãƒ³ãƒ‘ãƒ³", w:5}, {n:"ã‚¢ãƒ•ã‚¿ãƒ¼", w:10}] }
        ];

        // åˆæœŸåŒ–
        function init() {
            const container = document.getElementById('weight-inputs');
            const select = document.getElementById('template-select');
            for (let i = 0; i < 10; i++) {
                container.innerHTML += `
                    <div class="flex gap-2">
                        <input type="text" id="name-${i}" placeholder="é …ç›®${i+1}" class="flex-[2] p-2 bg-slate-50 border border-slate-200 rounded-xl text-xs font-bold outline-none focus:ring-1 focus:ring-indigo-500">
                        <input type="number" id="weight-${i}" placeholder="%" class="flex-1 p-2 bg-slate-50 border border-slate-200 rounded-xl text-xs font-bold text-center outline-none focus:ring-1 focus:ring-indigo-500" min="0" max="100">
                    </div>`;
            }
            templates.forEach((t, i) => {
                select.innerHTML += `<option value="${i}">${t.name}</option>`;
            });

            // ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²
            document.querySelectorAll('#weight-inputs input').forEach(el => {
                el.addEventListener('input', () => { updateTotal(); drawRoulette(); });
            });
            document.getElementById('roulette-items').addEventListener('input', drawRoulette);
            
            drawRoulette();
        }

        function toggleMode() {
            const mode = document.getElementById('mode-select').value;
            document.getElementById('equal-area').classList.toggle('hidden', mode !== 'equal');
            document.getElementById('custom-area').classList.toggle('hidden', mode !== 'custom');
            drawRoulette();
        }

        function updateTotal() {
            let sum = 0;
            for (let i = 0; i < 10; i++) {
                sum += Number(document.getElementById(`weight-${i}`).value) || 0;
            }
            const display = document.getElementById('total-percent');
            display.innerText = sum;
            display.className = sum > 100 ? "text-red-500 font-bold" : "text-slate-400 font-bold";
        }

        function applyTemplate() {
            const idx = document.getElementById('template-select').value;
            if (idx === "") return;
            const items = templates[idx].items;
            for (let i = 0; i < 10; i++) {
                document.getElementById(`name-${i}`).value = items[i] ? items[i].n : "";
                document.getElementById(`weight-${i}`).value = items[i] ? items[i].w : "";
            }
            updateTotal();
            drawRoulette();
        }

        function getProcessedItems() {
            const mode = document.getElementById('mode-select').value;
            const order = document.getElementById('order-select').value;
            let list = [];

            if (mode === 'equal') {
                const lines = document.getElementById('roulette-items').value.split('\n').filter(i => i.trim() !== "");
                list = lines.map(name => ({ name, weight: 100 / lines.length }));
            } else {
                for (let i = 0; i < 10; i++) {
                    const n = document.getElementById(`name-${i}`).value.trim();
                    const w = Number(document.getElementById(`weight-${i}`).value);
                    if (n && w > 0) list.push({ name: n, weight: w });
                }
            }

            if (order === 'shuffle') {
                // Fisher-Yates shuffle
                for (let i = list.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [list[i], list[j]] = [list[j], list[i]];
                }
            }
            return list;
        }

        function drawRoulette() {
            const items = getProcessedItems();
            currentItems = items; // ã‚¹ãƒ”ãƒ³ç”¨ã«ä¿å­˜
            if (items.length === 0) {
                ctx.clearRect(0, 0, 320, 320);
                return;
            }

            const totalWeight = items.reduce((sum, item) => sum + item.weight, 0);
            let currentAngle = 0;
            ctx.clearRect(0, 0, 320, 320);

            items.forEach((item, i) => {
                const arc = (item.weight / totalWeight) * 2 * Math.PI;
                ctx.beginPath();
                ctx.fillStyle = `hsl(${(i * 360) / items.length}, 70%, 80%)`;
                ctx.moveTo(160, 160);
                ctx.arc(160, 160, 150, currentAngle, currentAngle + arc);
                ctx.fill();

                // ãƒ†ã‚­ã‚¹ãƒˆæç”»
                ctx.save();
                ctx.translate(160, 160);
                ctx.rotate(currentAngle + arc / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = "#334155";
                ctx.font = "bold 14px sans-serif";
                ctx.fillText(item.name.substring(0, 8), 140, 5);
                ctx.restore();

                currentAngle += arc;
            });
        }

        function spinRoulette() {
            if (currentItems.length === 0) return;
            const btn = document.getElementById('spin-btn');
            btn.disabled = true;
            document.getElementById('roulette-result').innerText = "æŠ½é¸ä¸­...";

            const rotateDeg = (10 + Math.random() * 5) * 360;
            currentRotation += rotateDeg;
            canvas.style.transform = `rotate(-${currentRotation}deg)`;

            setTimeout(() => {
                btn.disabled = false;
                // å½“é¸åˆ¤å®š (é‡ã¯çœŸä¸Š 270åº¦æ–¹å‘)
                const normalizedRotation = (currentRotation % 360);
                const totalWeight = currentItems.reduce((sum, item) => sum + item.weight, 0);
                
                // å›è»¢å¾Œã®0åº¦ä½ç½®ãŒã€é‡(çœŸä¸Š)ã«å¯¾ã—ã¦ã©ã®ä½ç½®ã«ã‚ã‚‹ã‹è¨ˆç®—
                let needleAngle = (270 + normalizedRotation) % 360;
                let cumulativeAngle = 0;
                let winner = currentItems[0];

                for (const item of currentItems) {
                    const itemAngle = (item.weight / totalWeight) * 360;
                    if (needleAngle >= cumulativeAngle && needleAngle < cumulativeAngle + itemAngle) {
                        winner = item;
                        break;
                    }
                    cumulativeAngle += itemAngle;
                }
                
                document.getElementById('roulette-result').innerText = `âœ¨ ${winner.name} âœ¨`;
            }, 4000);
        }

        init();
    </script>
</body>
</html>