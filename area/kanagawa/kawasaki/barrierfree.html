<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å·å´å­è‚²ã¦MAP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body class="bg-orange-50/30 text-slate-800 min-h-screen">
    <nav class="bg-white border-b border-orange-100 py-3 px-4 sticky top-0 z-[1000]">
        <div class="container mx-auto flex justify-between items-center">
            <span class="font-bold text-orange-600">å·å´å­è‚²ã¦MAP</span>
            <button onclick="getLocation()" class="bg-orange-500 text-white px-3 py-1 rounded-full text-[10px]">ç¾åœ¨åœ°</button>
        </div>
    </nav>

    <main class="p-4">
        <div id="map" style="height: 300px; width: 100%; border-radius: 1rem;" class="mb-4"></div>
        <div id="loading" class="text-center py-10 font-bold">ğŸ“¡ ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­...</div>
        <div id="results" class="space-y-4"></div>
    </main>

    <script>
        const DATA_URL = '../area/kanagawa/kawasaki/kawasaki-barrierfree.csv';
        let allData = [];
        let map;

        function initMap() {
            map = L.map('map').setView([35.5308, 139.7029], 12);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        }

        async function loadData() {
            Papa.parse(DATA_URL, {
                download: true,
                header: true,
                skipEmptyLines: true,
                encoding: "Shift-JIS",
                complete: (results) => {
                    console.log("CSV Load OK:", results.data.length);
                    allData = results.data.filter(row => row["åç§°"]);
                    document.getElementById('loading').style.display = 'none';
                    render();
                },
                error: (err) => {
                    document.getElementById('loading').innerText = "âš ï¸ ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: " + DATA_URL;
                }
            });
        }

        function render() {
            const container = document.getElementById('results');
            container.innerHTML = '';

            allData.forEach(item => {
                const name = item["åç§°"];
                const addr = item["æ‰€åœ¨åœ°_é€£çµè¡¨è¨˜"];
                
                // ã€Œå¯ã€ã¨ã„ã†æ–‡å­—ãŒã‚ã‚‹ã‹åˆ¤å®š
                const tags = [];
                if (item["ãŠã‚€ã¤æ›¿ãˆã‚³ãƒ¼ãƒŠãƒ¼"] === "å¯") tags.push('<span class="bg-pink-100 text-pink-600 px-2 py-1 rounded text-[10px] font-bold">ğŸ¼ ãŠã‚€ã¤æ›¿ãˆ</span>');
                if (item["æˆä¹³å®¤"] === "å¯") tags.push('<span class="bg-rose-100 text-rose-600 px-2 py-1 rounded text-[10px] font-bold">ğŸ¤± æˆä¹³å®¤</span>');
                if (item["ãƒ™ãƒ“ãƒ¼ã‚«ãƒ¼åˆ©ç”¨"] === "å¯") tags.push('<span class="bg-orange-100 text-orange-600 px-2 py-1 rounded text-[10px] font-bold">ğŸ›’ ãƒ™ãƒ“ãƒ¼ã‚«ãƒ¼å¯</span>');

                if (tags.length > 0) { // ä½•ã‹å­è‚²ã¦è¨­å‚™ãŒã‚ã‚‹å ´åˆã®ã¿è¡¨ç¤º
                    const div = document.createElement('div');
                    div.className = "bg-white p-4 rounded-xl shadow-sm border border-orange-50";
                    div.innerHTML = `
                        <h3 class="font-bold text-sm mb-1">${name}</h3>
                        <p class="text-[10px] text-slate-400 mb-2">ğŸ“ ${addr}</p>
                        <div class="flex flex-wrap gap-1">${tags.join('')}</div>
                    `;
                    container.appendChild(div);

                    const lat = parseFloat(item["ç·¯åº¦"]);
                    const lng = parseFloat(item["çµŒåº¦"]);
                    if (!isNaN(lat) && !isNaN(lng)) {
                        L.marker([lat, lng]).addTo(map).bindPopup(name);
                    }
                }
            });
        }

        function getLocation() {
            navigator.geolocation.getCurrentPosition(pos => {
                map.setView([pos.coords.latitude, pos.coords.longitude], 15);
            });
        }

        initMap();
        loadData();
    </script>
</body>
</html>
