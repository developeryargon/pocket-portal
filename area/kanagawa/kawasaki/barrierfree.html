<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·å´ãŠå‡ºã‹ã‘ãƒãƒªã‚¢ãƒ•ãƒªãƒ¼MAP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap');
        body { font-family: 'Noto Sans JP', sans-serif; }
        .feature-tag { font-size: 0.7rem; padding: 2px 8px; border-radius: 9999px; font-weight: bold; }
    </style>
</head>
<body class="bg-pink-50 min-h-screen">

    <header class="bg-white border-b border-pink-100 p-4 sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-pink-600 text-xl font-bold flex items-center">
                    <span class="mr-2">ğŸ‘¶</span> å·å´ãŠå‡ºã‹ã‘ãƒãƒªã‚¢ãƒ•ãƒªãƒ¼MAP
                </h1>
                <p class="text-[10px] text-gray-400">å·å´å¸‚ãƒãƒªã‚¢ãƒ•ãƒªãƒ¼æƒ…å ±ã‚ªãƒ¼ãƒ—ãƒ³ãƒ‡ãƒ¼ã‚¿æ´»ç”¨</p>
            </div>
            <button onclick="loadData()" class="text-xs bg-pink-100 text-pink-600 px-3 py-1 rounded-full font-bold">æ›´æ–°</button>
        </div>
    </header>

    <nav class="bg-white p-4 shadow-sm mb-4">
        <div class="container mx-auto">
            <p class="text-xs font-bold text-gray-400 mb-2 uppercase">è¨­å‚™ã§çµã‚Šè¾¼ã‚€</p>
            <div class="flex flex-wrap gap-2">
                <button onclick="toggleFilter('wheelchair')" id="btn-wheelchair" class="filter-btn bg-gray-100 text-gray-600 px-3 py-2 rounded-lg text-xs font-bold transition-all border border-transparent">â™¿ï¸ è»Šæ¤…å­ç”¨ãƒˆã‚¤ãƒ¬</button>
                <button onclick="toggleFilter('baby')" id="btn-baby" class="filter-btn bg-gray-100 text-gray-600 px-3 py-2 rounded-lg text-xs font-bold transition-all border border-transparent">ğŸ¼ ãŠã‚€ã¤æ›¿ãˆå°</button>
                <button onclick="toggleFilter('elevator')" id="btn-elevator" class="filter-btn bg-gray-100 text-gray-600 px-3 py-2 rounded-lg text-xs font-bold transition-all border border-transparent">ğŸ›— ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼</button>
            </div>
            <input type="text" id="keyword" placeholder="æ–½è¨­åã‚„åŒºåã§æ¤œç´¢..." class="w-full mt-4 p-3 bg-gray-50 border-none rounded-xl text-sm focus:ring-2 focus:ring-pink-300 outline-none">
        </div>
    </nav>

    <main class="container mx-auto p-4">
        <div id="loading" class="text-center py-20 text-gray-400">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
        <div id="results" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    </main>

    <script>
        // æœ¬æ¥ã¯å·å´å¸‚ã®ãƒãƒªã‚¢ãƒ•ãƒªãƒ¼æ–½è¨­CSVã®URLã‚’æŒ‡å®š
        // ä¾‹: https://www.city.kawasaki.jp/opendata/cmsfiles/contents/0000xxx/xxxx/barrierfree.csv
        const DATA_URL = 'https://www.city.kawasaki.jp/shisetsu/category/42-12-0-0-0-0-0-0-0-0.csv';

        let allData = [];
        let activeFilters = { wheelchair: false, baby: false, elevator: false };

        async function loadData() {
            document.getElementById('loading').style.display = 'block';
            
            // å·å´å¸‚ã®CSVèª­ã¿è¾¼ã¿ï¼ˆCORSåˆ¶é™ãŒã‚ã‚‹å ´åˆã¯fallbackã¸ï¼‰
            Papa.parse(DATA_URL, {
                download: true,
                header: true,
                complete: (results) => {
                    allData = results.data;
                    render();
                },
                error: () => {
                    console.log("CORSåˆ¶é™ã®ãŸã‚ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã—ã¾ã™");
                    allData = [
                        { name: "å·å´å¸‚å½¹æ‰€æœ¬åºèˆ", ward: "å·å´åŒº", address: "å·å´åŒºå®®æœ¬ç”º1", wheelchair: true, baby: true, elevator: true },
                        { name: "ä¸­åŸå›³æ›¸é¤¨", ward: "ä¸­åŸåŒº", address: "ä¸­åŸåŒºå°æ‰ç”º3-1301", wheelchair: true, baby: true, elevator: true },
                        { name: "ç­‰ã€…åŠ›é™¸åœ°", ward: "ä¸­åŸåŒº", address: "ä¸­åŸåŒºç­‰ã€…åŠ›1-1", wheelchair: true, baby: false, elevator: false },
                        { name: "éº»ç”ŸåŒºå½¹æ‰€", ward: "éº»ç”ŸåŒº", address: "éº»ç”ŸåŒºä¸‡ç¦å¯º1-5-1", wheelchair: true, baby: true, elevator: true },
                        { name: "ç”Ÿç”°ç·‘åœ°", ward: "å¤šæ‘©åŒº", address: "å¤šæ‘©åŒºæ¡å½¢7-1-4", wheelchair: true, baby: true, elevator: false }
                    ];
                    render();
                }
            });
        }

        function toggleFilter(type) {
            activeFilters[type] = !activeFilters[type];
            const btn = document.getElementById(`btn-${type}`);
            if (activeFilters[type]) {
                btn.classList.replace('bg-gray-100', 'bg-pink-500');
                btn.classList.replace('text-gray-600', 'text-white');
            } else {
                btn.classList.replace('bg-pink-500', 'bg-gray-100');
                btn.classList.replace('text-white', 'text-gray-600');
            }
            render();
        }

        function render() {
            document.getElementById('loading').style.display = 'none';
            const container = document.getElementById('results');
            const keyword = document.getElementById('keyword').value.toLowerCase();
            container.innerHTML = '';

            const filtered = allData.filter(item => {
                const name = (item.name || item['åç§°'] || "").toLowerCase();
                const addr = (item.address || item['æ‰€åœ¨åœ°'] || "").toLowerCase();
                const matchKeyword = name.includes(keyword) || addr.includes(keyword);
                
                // ç°¡æ˜“çš„ãªè¨­å‚™ãƒ•ãƒ©ã‚°ãƒã‚§ãƒƒã‚¯
                const matchWheelchair = !activeFilters.wheelchair || (item.wheelchair || item['è»Šæ¤…å­ç”¨ãƒˆã‚¤ãƒ¬'] === 'â—‹');
                const matchBaby = !activeFilters.baby || (item.baby || item['ãŠã‚€ã¤æ›¿ãˆå°'] === 'â—‹');
                const matchElevator = !activeFilters.elevator || (item.elevator || item['ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼'] === 'â—‹');

                return matchKeyword && matchWheelchair && matchBaby && matchElevator;
            });

            filtered.forEach(item => {
                const div = document.createElement('div');
                div.className = "bg-white rounded-2xl p-5 shadow-sm border border-pink-100 hover:shadow-md transition-all";
                div.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <span class="text-[10px] font-bold text-pink-400 bg-pink-50 px-2 py-1 rounded">${item.ward || 'å·å´å¸‚'}</span>
                    </div>
                    <h3 class="font-bold text-gray-800 mb-1">${item.name || item['åç§°']}</h3>
                    <p class="text-[11px] text-gray-400 mb-4">ğŸ“ ${item.address || item['æ‰€åœ¨åœ°']}</p>
                    <div class="flex flex-wrap gap-2">
                        ${(item.wheelchair || item['è»Šæ¤…å­ç”¨ãƒˆã‚¤ãƒ¬'] === 'â—‹') ? '<span class="feature-tag bg-blue-50 text-blue-500 border border-blue-100">â™¿ï¸ å¤šç›®çš„ãƒˆã‚¤ãƒ¬</span>' : ''}
                        ${(item.baby || item['ãŠã‚€ã¤æ›¿ãˆå°'] === 'â—‹') ? '<span class="feature-tag bg-yellow-50 text-yellow-600 border border-yellow-100">ğŸ¼ ãŠã‚€ã¤å°</span>' : ''}
                        ${(item.elevator || item['ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼'] === 'â—‹') ? '<span class="feature-tag bg-purple-50 text-purple-500 border border-purple-100">ğŸ›— EVã‚ã‚Š</span>' : ''}
                    </div>
                `;
                container.appendChild(div);
            });
        }

        document.getElementById('keyword').addEventListener('input', render);
        loadData();
    </script>
</body>
</html>